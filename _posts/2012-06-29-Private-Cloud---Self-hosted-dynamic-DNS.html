---           
layout: post
title: Private Cloud - Self-hosted dynamic DNS
date: 2012-06-29 18:45:49 UTC
updated: 2012-06-29 18:45:49 UTC
comments: false
categories: Private-Cloud
---

<div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-m4NB-INMXgQ/T-33t3OENoI/AAAAAAAAAKM/GPH7zpQZd5U/s1600/IMG_0062.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="219" src="http://3.bp.blogspot.com/-m4NB-INMXgQ/T-33t3OENoI/AAAAAAAAAKM/GPH7zpQZd5U/s320/IMG_0062.jpg" title=" " width="320" /></a></div><br />Running my private Cloud for some time now, I share some experience and scripts.<br /><br />I want to describe the solutions I build to run DNS, Mail and Webservices on my own infrastructure behind a NATed, dynamically-IP-assigned private Internet connection. I´ll start with the DNS because it is the most fundamental requirement.<br /><br /><b>Running self-hosted DNS</b> <b>for dynamically assigned IPs</b><br /><br />I did not want to use DnyDNS or similar (for now), so I quickly set up my own scripts to do the same.<br /><br />Here is a quick sketch of my own Dyn-DNS solution. You´ll need:<br /><ul><li>a server instance to set up your and hold your DNS zone (I use an EC2 instance), be sure to have a static IP assigned</li><li>some kind of secondary DNS (see below)</li><li>some scripts to update your zonefiles every time your IP changes </li></ul>The idea is that every time you change your zonefile, all your secondary DNS server get notified and pull the updates. <br /><br />To setup your DNS to react to dynamically assigned IPs one simply updates the zone-file every time the IP address changes. This can be easily achieved by a simple script that runs as cron-job on the home server like so:<br /><br /><div class="gistLoad" data-id="3019538" id="gist-3019538">Loading ....</div><br />The script queries it ISP-Ip via http://canihazip.com (which will be replaced by my own webservice soon :) and stores the info into a file. Next time it runs, it checks if the IP has changed and if so, does update the Zone file.<br /><br /><div class="gistLoad" data-id="3019733" id="gist-3019733">Loading ....</div><br />This is a simple template - replacement pattern: open a template file, replace stuff and write it out. This way I can write complex zone files and get my IP updated dynamically.<br /><br />I am going to put this script and a zone file example template onto the <a href="https://github.com/dubspeed/microserver">github project page</a>, asap.<br /><br />The last step in this process is to upload the zonefile to the remote server and restart bind remotely to make the changes take effect. I do it with a simple shell-script that SSH-es to the remote server:<br /><br /><div class="gistLoad" data-id="3019740" id="gist-3019740">Loading ....</div><br /><b>DNS with only 1 static IP</b><br /><br />In theory running DNS for any domain on a custom server instance should be no problem, but unfortunately many (all?) domains require two static DNS servers to be registered in the corresponding root-Zone. Luckily my Domain-Registry allows me to configure their DNS as secondary-DNS, otherwise I would use BackupDNS or similar.<br /><br />These services might interest you, if your provider does´t provide backup-DNS:<br /><br /><ul><li>http://www.twisted4life.com/index.php (free)</li><li>http://www.dnsmadeeasy.com/ ($2.50 / mo)</li><li>http://www.backupdns.com ($0.80 / zone / mo)</li><li>http://www.zoneedit.com ($1.00 / mo)</li></ul><br />Anyway, if you have two servers and two static IPs on the net, you can use them both of course :)<br /><br /><b>Conclusion</b><br /><br />Self-hosting dynamic DNS is fun, but a bit more complex to setup and run, but gives you more control over your DNS stuff e.g. unlimited A records and CNAMES etc. <br /><br />I still have to keep and maintain my AWS micro instance, which I wanted to replace in the first place. In my next posts I will make more use of it by using this instance as a mail relay and Web-Proxy.<br /><br /><script src="https://raw.github.com/moski/gist-Blogger/master/public/gistLoader.js" type="text/javascript"></script>